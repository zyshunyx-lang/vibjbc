generate() {
        const ms=document.getElementById('genMonth').value; if(!ms)return alert('选月份');
        const [y,m]=ms.split('-').map(Number), days=new Date(y,m,0).getDate(), hl=this.data.holidays[String(y)]||[];
        const getI=(id,t)=>{const n=document.getElementById(id).value; return Math.max(0,(this.data.personnel[t]||[]).findIndex(p=>p.name===n))};
        let iw=getI('slW','leader'), ih=getI('slH','leader'), ife=getI('sf','female'), ima=getI('sm','male');
        const pL=this.data.personnel.leader, pF=this.data.personnel.female, pM=this.data.personnel.male;
        
        // --- V35 强力验证补丁 Start ---
        
        // 1. 核心逻辑：轮空检查 (增强版，防止 undefined)
        const isSkipped = (p, dateStr) => {
            if (!p || !p.skips || !Array.isArray(p.skips)) return false;
            return p.skips.some(s => dateStr >= s.start && dateStr <= s.end);
        };
        
        // 2. 选人逻辑 (含日志自证)
        const pick=(list, start, dateStr)=>{
            let c=start, cnt=0; 
            while(cnt<list.length){ 
                const p=list[c%list.length]; 
                // 如果没有轮空，直接返回
                if(!isSkipped(p, dateStr)) return {name:p.name, next:(c+1)%list.length}; 
                
                // 日志自证：明确记录跳过动作
                // 格式：[生成过滤] 2025-11-05 跳过张三 (处于轮空期)
                this.log('生成过滤', `${dateStr} 跳过 ${p.name} (处于轮空期)`);
                
                // 消耗轮次 (c++)，寻找下一位
                c++; cnt++; 
            } 
            return {name:'无可用', next:c};
        };

        if(!pL.length) return alert('人员不足');
        
        for(let d=1;d<=days;d++) {
            const ds=`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`, isH=hl.includes(ds);
            
            // 初步选人
            let l; 
            if(isH){ const r=pick(pL,ih,ds); l=r.name; ih=r.next; } 
            else { const r=pick(pL,iw,ds); l=r.name; iw=r.next; }
            
            const f=pick(pF,ife,ds); ife=f.next; 
            const ma=pick(pM,ima,ds); ima=ma.next;

            // 3. 强力验证：二次确认 (Double Confirmation)
            // 防止算法死角，虽然 pick 已经检查过，这里做最终兜底
            const finalCheck = (name, list) => {
                 const p = list.find(x => x.name === name);
                 if(p && isSkipped(p, ds)) {
                     this.log('严重警告', `${ds} 异常排入轮空人员 ${name}，请检查数据`);
                     return `${name}(轮空异常)`; // 显性标记错误
                 }
                 return name;
            };

            const lFinal = finalCheck(l, pL);
            const fFinal = finalCheck(f.name, pF);
            const mFinal = finalCheck(ma.name, pM);

            this.data.schedules[ds]={leader:lFinal, female:fFinal, male:mFinal, remark:''};
        }
        // --- V35 强力验证补丁 End ---

        this.renderCal(); 
        this.toast('⚡ 预览已生成 (含V35强力验证)');
    },
